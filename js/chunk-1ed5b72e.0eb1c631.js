(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-1ed5b72e","chunk-135b4322","chunk-2d0c4d4a"],{"3d03":function(t,e,a){"use strict";a.r(e);var i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("a-drawer",{attrs:{title:"修改",placement:"right",closable:!1,maskClosable:!1,visible:this.visible.show,width:700}},[a("a-form",{attrs:{form:t.form}},[a("a-form-item",{attrs:{label:"财年",labelCol:{span:4},wrapperCol:{span:20}}},[a("a-select",{directives:[{name:"decorator",rawName:"v-decorator",value:["BudgetGuid",{initialValue:t.visible.detail.BudgetGuid,rules:t.AFormImportRules.iptSelect}],expression:"['BudgetGuid',{initialValue:visible.detail.BudgetGuid,rules:AFormImportRules.iptSelect }]"}],staticStyle:{width:"60%","margin-right":"8px"},attrs:{placeholder:"请选择",allowClear:!0,disabled:!!t.visible.detail.BudgetDeptGuid},on:{change:t.selectFiscalYearChange}},t._l(t.dim.budgets,function(e){return a("a-select-option",{key:e.BudgetGuid},[t._v(t._s(e.FiscalYear))])}),1)],1),a("a-form-item",{attrs:{label:"部门",labelCol:{span:4},wrapperCol:{span:20}}},[a("a-cascader",{directives:[{name:"decorator",rawName:"v-decorator",value:["Depts",{initialValue:t.visible.detail.DepPath,rules:t.AFormImportRules.iptSelect}],expression:"['Depts',{initialValue:visible.detail.DepPath,rules:AFormImportRules.iptSelect }]"}],attrs:{options:t.dim.depts,changeOnSelect:"",placeholder:"请选择",disabled:!!t.visible.detail.BudgetDeptGuid}})],1),t._l(t.dim.subjects,function(e,i){return a("a-form-item",{key:i,attrs:{label:e.Name,labelCol:{span:4},wrapperCol:{span:20}}},[a("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["Amount["+e.BSGuid+"]",{rules:t.AFormImportRules.iptInput}],expression:"[`Amount[${item.BSGuid}]`,\n        {\n          rules: AFormImportRules.iptInput,\n        }\n      ]"}],staticStyle:{width:"60%","margin-right":"8px"}})],1)}),a("a-form-item",{attrs:{label:"备注",labelCol:{span:4},wrapperCol:{span:20}}},[a("a-textarea",{directives:[{name:"decorator",rawName:"v-decorator",value:["Remarks",{initialValue:t.visible.detail.Remarks}],expression:"['Remarks',{initialValue:visible.detail.Remarks }]"}],attrs:{placeholder:"备注",rows:4}})],1)],2),a("div",{style:{position:"absolute",bottom:0,width:"100%",borderTop:"1px solid #e8e8e8",padding:"10px 16px",textAlign:"right",left:0,background:"#fff",borderRadius:"0 0 4px 4px"}},[a("a-button",{on:{click:t.onClose}},[t._v("取消")]),a("a-button",{staticStyle:{"margin-left":"8px"},attrs:{type:"primary","html-type":"submit"},on:{click:t.handleSubmit}},[t._v("提交")]),null==t.visible.id?a("a-button",{staticStyle:{"margin-left":"8px"},on:{click:function(e){return t.handleSubmit("next")}}},[t._v("提交并继续录入")]):t._e()],1)],1)},s=[],r=(a("ac6a"),a("b775")),l={props:{show:{type:Object,default:{show:!1}},refresh:{type:Function,default:null}},data:function(){return{visible:{show:!1,detail:{BudgetGuid:void 0}},dim:{depts:[],subjects:[],budgets:[]},subjects:[],form:this.$form.createForm(this),AFormImportRules:{iptInput:[{required:!0,message:"请输入"}],iptSelect:[{required:!0,message:"请选择"}]}}},watch:{show:function(t,e){var a=this;a.visible=t,t.show&&(null==a.visible.detail&&(a.visible.detail={BudgetGuid:void 0}),a.init())}},methods:{onClose:function(){this.visible.show=!1,this.refresh&&this.refresh(),this.dim.subjects=[],this.form.resetFields()},init:function(){var t=this;r["a"].post("/api/Budget/Set/InitGroups").then(function(e){0===e.code&&(t.dim.depts=e.data.depts,t.dim.budgets=e.data.budgets)}).catch(function(t){console.log(t)}),t.visible.detail.BudgetDeptGuid&&r["a"].post("/api/Budget/Formation/GetItems",{BudgetDeptGuid:t.visible.detail.BudgetDeptGuid}).then(function(e){0===e.code&&(e.data.budget_Dept.DepPath=JSON.parse(e.data.budget_Dept.DepPath),t.visible.detail=e.data.budget_Dept,t.selectFiscalYearChange(t.visible.detail.BudgetGuid).then(function(){var a={};e.data.items.forEach(function(t){var e="Amount["+t.BSGuid+"]";a[e]=t.Amount}),t.form.setFieldsValue(a)}))}).catch(function(t){console.log(t)})},handleSubmit:function(t){var e=this;this.form.validateFields(function(a,i){if(!a){var s=i;s.Amount=JSON.stringify(i.Amount),s.DepPath=JSON.stringify(i.Depts),s.DepGuid=i.Depts[i.Depts.length-1],s.BudgetDeptGuid=e.visible.detail.BudgetDeptGuid,r["a"].post("/api/Budget/Formation/SaveItem",s).then(function(a){var i=a;i.code>0?e.$message.error(i.msg):("next"===t?(e.form.resetFields(),e.refresh&&e.refresh()):e.onClose(),e.$message.success(i.msg))}).catch(function(t){console.log(t)})}})},selectFiscalYearChange:function(t){var e=this;if(t)return e.dim.subjects=[],r["a"].post("/api/Budget/Set/GetConfig",{BudgetGuid:t}).then(function(t){0===t.code&&(e.dim.subjects=t.data.subjects)}).catch(function(t){console.log(t)});e.dim.subjects=[]}}},o=l,n=a("2877"),d=Object(n["a"])(o,i,s,!1,null,null,null);e["default"]=d.exports},8932:function(t,e,a){"use strict";a.r(e);var i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("a-layout",[a("a-layout-content",[a("a-card",{attrs:{bordered:!1}},[a("div",[a("a-form",{attrs:{layout:"horizontal"}},[a("div",{class:"fold"},[a("a-row",{attrs:{gutter:10}},[a("a-col",{attrs:{span:24}},[a("a-form-item",{attrs:{label:"财年",labelCol:{span:2},wrapperCol:{span:18}}},[a("a-select",{staticStyle:{width:"80px"},model:{value:t.formSearch.FiscalYear,callback:function(e){t.$set(t.formSearch,"FiscalYear",e)},expression:"formSearch.FiscalYear"}},[a("a-select-option",{attrs:{value:"2019"}},[t._v("2019")]),a("a-select-option",{attrs:{value:"2020"}},[t._v("2020")]),a("a-select-option",{attrs:{value:"2021"}},[t._v("2021")]),a("a-select-option",{attrs:{value:"2022"}},[t._v("2022")])],1),a("a-button",{staticStyle:{"margin-left":"8px"},attrs:{type:"primary"},on:{click:t.init}},[t._v("查询")]),a("a-button",{staticStyle:{"margin-left":"8px"},on:{click:function(e){return t.edit({BudgetGuid:void 0})}}},[t._v("添加")])],1)],1)],1)],1)])],1),a("a-table",{attrs:{columns:t.columns,dataSource:t.dataSource,pagination:!1,rowKey:function(t,e){return"complete"+t.DepGuid+e}},scopedSlots:t._u([{key:"sumamount",fn:function(e){return[t._v("\n          "+t._s(e.AmountChild+e.Amount)+"\n        ")]}},{key:"action",fn:function(e,i){return a("span",{staticStyle:{"text-align":"right"},attrs:{disabled:!i.BudgetDeptGuid||1==i.Status}},[a("a",{attrs:{disabled:!i.BudgetDeptGuid},on:{click:function(e){return t.detail(i)}}},[t._v("详情")]),a("a-divider",{attrs:{type:"vertical"}}),a("a-dropdown",[a("a",{staticClass:"ant-dropdown-link",attrs:{disabled:!i.BudgetDeptGuid||1==i.Status}},[t._v("\n              更多\n              "),a("a-icon",{attrs:{type:"down"}})],1),a("a-menu",{attrs:{slot:"overlay"},slot:"overlay"},[a("a-menu-item",{attrs:{disabled:!i.BudgetDeptGuid||1==i.Status},on:{click:function(e){return t.edit(i)}}},[t._v("修改")])],1)],1)],1)}}])})],1)],1),a("drawer-edit",{attrs:{show:t.drawer.edit,refresh:t.init,destroyOnClose:!0}}),a("drawer-detail",{attrs:{show:t.drawer.detail,refresh:t.init}})],1)},s=[],r=a("b775"),l=a("3d03"),o=a("aac1"),n=[{title:"部门",dataIndex:"DeptName"},{title:"状态",dataIndex:"StatusText"},{title:"部门预算",dataIndex:"Amount"},{title:"子部门预算",dataIndex:"AmountChild"},{title:"预算",scopedSlots:{customRender:"sumamount"}},{title:"备注",dataIndex:"Remarks"},{title:"操作",scopedSlots:{customRender:"action"}}],d={components:{DrawerEdit:l["default"],DrawerDetail:o["default"]},data:function(){return{columns:n,formSearch:{FiscalYear:2019},dataSource:[],drawer:{detail:{show:!1},edit:{show:!1}}}},mounted:function(){var t=this;t.formSearch.FiscalYear=(new Date).getFullYear(),t.init()},methods:{init:function(t){var e=this;r["a"].post("/api/Budget/Formation/List",e.formSearch).then(function(t){var a=t;0===a.code&&(e.dataSource=a.data)}).catch(function(t){console.log(t)})},detail:function(t){this.drawer.detail={show:!0,id:t.BudgetDeptGuid,detail:t}},edit:function(t){this.drawer.edit={show:!0,id:t.BudgetDeptGuid,detail:t}}}},u=d,c=(a("ebcb"),a("2877")),p=Object(c["a"])(u,i,s,!1,null,null,null);e["default"]=p.exports},"9a1d":function(t,e,a){},aac1:function(t,e,a){"use strict";a.r(e);var i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("a-drawer",{attrs:{message:"",visible:this.visible.show,width:650,destroyOnClose:!0,closable:!1},on:{close:t.onClose}},[a("template",{slot:"title"},[t._v("\n    详情\n    "),0==t.visible.detail.Status?a("a-button",{staticStyle:{float:"right"},attrs:{size:"small",icon:"form"},on:{click:t.edit}},[t._v("修改")]):t._e()],1),a("a-row",{staticStyle:{padding:"8px 0"},attrs:{gutter:10}},[a("a-col",{staticStyle:{"text-align":"right"},attrs:{span:4}},[t._v("部门:")]),a("a-col",{attrs:{span:6}},[t._v(t._s(t.visible.detail.DeptName))]),a("a-col",{staticStyle:{"text-align":"right"},attrs:{span:4}},[t._v("部门预算:")]),a("a-col",{attrs:{span:6}},[t._v(t._s(t.visible.detail.Amount))])],1),a("a-row",{staticStyle:{padding:"8px 0"},attrs:{gutter:10}},[a("a-col",{staticStyle:{"text-align":"right"},attrs:{span:4}},[t._v("子部门预算:")]),a("a-col",{attrs:{span:6}},[t._v(t._s(t.visible.detail.AmountChild))]),a("a-col",{staticStyle:{"text-align":"right"},attrs:{span:4}},[t._v("预算:")]),a("a-col",{attrs:{span:6}},[t._v(t._s(t.visible.detail.AmountChild+t.visible.detail.Amount))])],1),a("a-row",{staticStyle:{padding:"8px 0"},attrs:{gutter:10}},[a("a-col",{staticStyle:{"text-align":"right"},attrs:{span:4}},[t._v("状态:")]),a("a-col",{attrs:{span:6}},[t._v(t._s(t.visible.detail.StatusText))])],1),a("a-row",{staticStyle:{padding:"8px 0"},attrs:{gutter:10}},[a("a-col",{staticStyle:{"text-align":"right"},attrs:{span:4}},[t._v("备注:")]),a("a-col",{attrs:{span:16}},[t._v(t._s(t.visible.detail.Remarks))])],1),a("a-divider",{attrs:{orientation:"left"}},[t._v("部门预算详情")]),a("a-table",{attrs:{columns:t.columns,dataSource:t.dataSource,bordered:!1,pagination:!1,size:"middle",rowKey:"BudgetItemGuid"}}),a("drawer-edit",{attrs:{show:t.drawer.edit,refresh:t.init}})],2)},s=[],r=(a("ac6a"),a("b775")),l=a("3d03"),o=[{title:"科目",dataIndex:"Name"},{title:"预算",dataIndex:"Amount"}],n={components:{DrawerEdit:l["default"]},props:{show:{type:Object,default:{show:!1}},refresh:{type:Function,default:null}},data:function(){return{visible:{show:!1,detail:{}},columns:o,dataSource:[],form:this.$form.createForm(this),drawer:{edit:{show:!1}},modal:{outchange:{show:!1}}}},created:function(){var t=this;this.$watch("show",function(e,a){t.visible=e,t.visible.show&&t.init()})},methods:{init:function(){var t=this;r["a"].post("/api/Budget/Formation/ItemList",{BudgetDeptGuid:t.show.id}).then(function(e){if(0===e.code){t.dataSource=e.data;var a=0;e.data.forEach(function(t){a+=t.Amount}),t.visible.detail.Amount=a}}).catch(function(t){console.log(t)})},onClose:function(){this.visible.show=!1,this.dataSource=[],this.refresh&&this.refresh()},detail:function(t){this.drawer.detail={show:!0,id:t.SBOrderItemGuid}},edit:function(){this.drawer.edit={show:!0,id:this.show.id,detail:this.visible.detail}}}},d=n,u=a("2877"),c=Object(u["a"])(d,i,s,!1,null,null,null);e["default"]=c.exports},ebcb:function(t,e,a){"use strict";var i=a("9a1d"),s=a.n(i);s.a}}]);