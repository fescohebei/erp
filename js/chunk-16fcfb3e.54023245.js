(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-16fcfb3e","chunk-2d2140a4"],{"2f21":function(e,t,a){"use strict";var r=a("79e5");e.exports=function(e,t){return!!e&&r(function(){t?e.call(null,function(){},1):e.call(null)})}},"32d0":function(e,t,a){"use strict";var r=a("7f47"),n=a.n(r);n.a},"55dd":function(e,t,a){"use strict";var r=a("5ca1"),n=a("d8e8"),o=a("4bf8"),i=a("79e5"),s=[].sort,c=[1,2,3];r(r.P+r.F*(i(function(){c.sort(void 0)})||!i(function(){c.sort(null)})||!a("2f21")(s)),"Array",{sort:function(e){return void 0===e?s.call(o(this)):s.call(o(this),n(e))}})},"7f47":function(e,t,a){},"81ae":function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("a-layout",[a("a-layout-content",[a("a-card",{attrs:{bordered:!1}},[a("a-row",{attrs:{gutter:40}},[a("a-col",{staticStyle:{"border-right":"1px solid #ddd","margin-right":"-1px"},attrs:{span:5}},[a("a-form",{attrs:{layout:"horizontal"}},[a("div",{class:e.advanced?null:"fold"},[a("div",{staticClass:"tab-title"},[e._v("筛选条件")]),a("a-row",{attrs:{gutter:10}},[a("a-col",{attrs:{md:24}},[a("a-form-item",{attrs:{label:"部门",labelCol:{span:8},wrapperCol:{span:16}}},[a("a-tree-select",{staticStyle:{width:"100%"},attrs:{multiple:"","tree-data-simple-mode":"","dropdown-style":{maxHeight:"400px",overflow:"auto"},"tree-data":e.treeData,placeholder:"请选择","load-data":e.onLoadData},on:{change:e.changeTree},model:{value:e.formSearch.DepIds,callback:function(t){e.$set(e.formSearch,"DepIds",t)},expression:"formSearch.DepIds"}})],1)],1),a("a-col",{attrs:{md:24}},[a("a-form-item",{attrs:{label:"人员",labelCol:{span:8},wrapperCol:{span:16}}},[a("a-select",{attrs:{mode:"multiple",allowClear:!0},model:{value:e.formSearch.Userids,callback:function(t){e.$set(e.formSearch,"Userids",t)},expression:"formSearch.Userids"}},e._l(e.UserList,function(t){return a("a-select-option",{key:t.code},[e._v(e._s(t.name))])}),1)],1)],1),a("a-col",{attrs:{md:24}},[a("a-form-item",{attrs:{label:"产品线",labelCol:{span:8},wrapperCol:{span:16}}},[a("a-select",{attrs:{placeholder:"请选择",allowClear:!0,mode:"multiple"},model:{value:e.formSearch.ProductLines,callback:function(t){e.$set(e.formSearch,"ProductLines",t)},expression:"formSearch.ProductLines"}},e._l(e.ComProductLine,function(t){return a("a-select-option",{key:t.key},[e._v(e._s(t.text))])}),1)],1)],1),a("a-col",{attrs:{md:24}},[a("a-form-item",{attrs:{label:"开始时间",labelCol:{span:8},wrapperCol:{span:16}}},[a("a-date-picker",{staticStyle:{width:"100%"},attrs:{format:"YYYY-MM-DD"},model:{value:e.formSearch.Begin,callback:function(t){e.$set(e.formSearch,"Begin",t)},expression:"formSearch.Begin"}})],1)],1),a("a-col",{attrs:{md:24}},[a("a-form-item",{attrs:{label:"结束时间",labelCol:{span:8},wrapperCol:{span:16}}},[a("a-date-picker",{staticStyle:{width:"100%"},attrs:{format:"YYYY-MM-DD"},model:{value:e.formSearch.End,callback:function(t){e.$set(e.formSearch,"End",t)},expression:"formSearch.End"}})],1)],1),a("a-col",{attrs:{md:16,offset:8}},[a("div",{staticClass:"btnBox"},[a("a-button",{staticStyle:{"margin-right":"10px"},attrs:{type:"primary",block:""},on:{click:e.initPage}},[e._v("查询")])],1)])],1)],1)])],1),a("a-col",{staticStyle:{"border-left":"1px solid #ddd"},attrs:{span:19}},[a("a-row",[a("a-col",{attrs:{span:22}},[a("a-form",{attrs:{form:e.dimensionForm}},[a("a-form-item",{attrs:{label:"请选择维度",labelCol:{span:2},wrapperCol:{span:17}}},[a("a-checkbox-group",{attrs:{name:"checkboxgroup",options:e.plainOptions,"default-value":[""]},on:{change:e.changeDim},model:{value:e.dimension,callback:function(t){e.dimension=t},expression:"dimension"}})],1)],1)],1),a("a-col",{attrs:{span:24}},[e.saleProcesslist.length>0||e.checkDim.length>0?a("a-table",{attrs:{columns:e.columnsDim,dataSource:e.saleProcesslist,pagination:!1,rowKey:"index"},scopedSlots:e._u([{key:"Stage",fn:function(t,r){return a("span",{staticStyle:{"text-align":"right"}},[e._v("\n                    "+e._s(e.SaleStageObj[r.Key.Stage])+"\n                  ")])}},{key:"ProductLine",fn:function(t,r){return a("span",{staticStyle:{"text-align":"right"}},[e._v("\n                    "+e._s(e.ComProductLineObj[r.Key.ProductLine])+"\n                  ")])}},{key:"userid",fn:function(t,r){return a("span",{staticStyle:{"text-align":"right"}},[e._v("\n                    "+e._s(e.User[r.Key.Userid])+"\n                  ")])}},{key:"lineNum",fn:function(t,r){return a("span",{staticStyle:{"text-align":"right"}},[a("a",{on:{click:function(t){return e.detail(r)}}},[e._v(e._s(r["产品线条数"]))])])}}],null,!1,1916815723)}):e._e()],1)],1)],1)],1)],1)],1),a("drawer-detail",{attrs:{show:e.drawer.detail,refresh:e.pagerefresh}})],1)},n=[],o=(a("8e6e"),a("456d"),a("55dd"),a("7f7f"),a("bd86")),i=(a("ac6a"),a("b775")),s=a("c32d"),c=a.n(s),l=a("aef0");function d(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),a.push.apply(a,r)}return a}function u(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?d(a,!0).forEach(function(t){Object(o["a"])(e,t,a[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):d(a).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))})}return e}var f=a("7104"),m=[],h={dataKey:"percent",nice:!1},p=(new f.View).source(m);p.transform({type:"percent",field:"Status",dimension:"action",as:"percent"});var g=p.rows,S={position:"action*percent",color:["action",["#0050B3","#1890FF","#40A9FF","#69C0FF","#BAE7FF"]],label:["action*Status",function(e,t){return e+" "+t},{offset:35,labelLine:{lineWidth:1,stroke:"rgba(0, 0, 0, 0.15)"}}],tooltip:["action*Status*percent",function(e,t,a){return{name:e,percent:Math.floor(100*a)+"%",Status:t}}]},b=[{title:"销售阶段",scopedSlots:{customRender:"Stage"}},{title:"产品线条数",scopedSlots:{customRender:"lineNum"}}],D=[{label:"按产品线",value:"1"},{label:"按人员",value:"2"}],v={0:"Stage",1:"ProductLine",2:"Userid"},y={components:{DrawerDetail:l["default"]},data:function(){return{advanced:!0,columnsDim:b,sourceData:m,formSearch:{DepIds:[],Userids:[],ProductLines:[]},middleSearch:{},form:this.$form.createForm(this),dimensionForm:this.$form.createForm(this),roles:[],drawer:{detail:{show:!1}},modal:{},invalidlayer:!1,confirmLoading:!1,invalidRecord:{},status:[],ContractResult:[],PayDaySuffix:{},User:{},Dept:{},moment:c.a,comRankObject:{},rolesmanager:!1,data:g,padding:[50,120,95],scale:h,height:350,funnelOpts:S,style:{fill:"#fff",fontSize:"12",textAlign:"center",shadowBlur:2,shadowColor:"rgba(0, 0, 0, .45)"},dv:p,options:[],UserList:[],ComProductLine:[],ComProductLineObj:{},plainOptions:D,dimension:["0"],checkDim:["0"],plainOptionsObject:v,saleProcesslist:[],SaleStageObj:{},treeData:[]}},mounted:function(){var e=this;e.init()},methods:{init:function(){var e=this;i["a"].post("/api/Dim/Enum/GetEnum",{Names:["ContractStatus","ContractResult","PayDaySuffix","ComRankNormal","ComProductLine","SaleStage"]}).then(function(t){0===t.code&&(e.status=t.data.ContractStatus,e.ContractResult=t.data.ContractResult,e.ComProductLine=t.data.ComProductLine,t.data.PayDaySuffix.forEach(function(t,a){e.PayDaySuffix[t.key]=t.text}),t.data.ComRankNormal.forEach(function(t,a){e.comRankObject[t.key]=t.text}),t.data.SaleStage.forEach(function(t,a){e.SaleStageObj[t.key]=t.text}),t.data.ComProductLine.forEach(function(t,a){e.ComProductLineObj[t.key]=t.text}))}).catch(function(e){console.log(e)}),i["a"].post("/api/Dim/Enum/DimDecode",{Names:["User","Dept"]}).then(function(t){e.$loading.close(),0===t.code&&(e.User=t.data.User,e.Dept=t.data.Dept)}).catch(function(t){e.$loading.close(),console.log(t)}),this.getAllDep(),this.pagechange(1)},initPage:function(){this.pagechange(1)},pagerefresh:function(){this.pagechange(this.formSearch.current)},pagechange:function(e){var t=this,a=u({},t.formSearch);t.formSearch.current=e,null==a.Begin?delete a.Begin:a.Begin=c()(a.Begin).format("YYYY-MM-DD"),null==a.End?delete a.End:a.End=c()(a.End).format("YYYY-MM-DD"),t.middleSearch=u({},t.formSearch),t.form.validateFields(function(e,a){e||t.serchDim()})},serchDim:function(){var e=this;if(e.checkDim.length>0){var t={};t=u({},e.middleSearch),null==t.Begin?delete t.Begin:t.Begin=c()(t.Begin).format("YYYY-MM-DD"),null==t.End?delete t.End:t.End=c()(t.End).format("YYYY-MM-DD"),t.Dims=[],e.checkDim.forEach(function(a){t.Dims.push(e.plainOptionsObject[a])}),i["a"].post("/api/Crm/Data/SalesProcessByUpTime",t).then(function(t){e.$loading.close(),0===t.code&&(e.saleProcesslist=t.data.rows)}).catch(function(t){e.$loading.close(),console.log(t)})}},detail:function(e){var t=this;this.drawer.detail={show:!0,pFormSearch:t.formSearch,detail:e}},statusChange:function(e){this.formSearch.Result=40==e?10:""},getAllDep:function(){var e=this;i["a"].get("/api/Org/Department/DepsByCurUser").then(function(t){0===t.code&&t.data.forEach(function(t,a){var r={};r.id=t.code,r.pId=0,r.value=t.code,r.title=t.name,r.isLeaf=!1,e.treeData.push(r)})}).catch(function(e){console.log(e)})},userbydepid:function(){var e=this;i["a"].post("/api/Org/User/DescendantsUsersByDepId",{DepIds:e.formSearch.DepIds,Leaved:!1}).then(function(t){var a=t;0===a.code&&(e.UserList=a.data)}).catch(function(e){console.log(e)})},changeDim:function(e){var t=[],a=[{title:"销售阶段",scopedSlots:{customRender:"Stage"}},{title:"产品线",scopedSlots:{customRender:"ProductLine"}},{title:"人员",scopedSlots:{customRender:"userid"}}];e.sort(function(e,t){return e-t}),console.log(e),e.length>0&&(e.forEach(function(e){t.push(a[e])}),t.push({title:"产品线条数",scopedSlots:{customRender:"lineNum"}})),this.columnsDim=t,this.checkDim=e,this.serchDim()},onLoadData:function(e){var t=this;return new Promise(function(a){var r=e.dataRef.id;i["a"].post("/api/Org/Department/ChildrenDepsByDepId",{DepId:r}).then(function(e){if(0===e.code)if(e.data.length>0){var a=[];e.data.forEach(function(e,t){var n={};n.id=e.code,n.pId=r,n.value=e.code,n.title=e.name,n.isLeaf=!1,a.push(n)}),t.treeData=t.treeData.concat(a)}else t.treeData=t.treeData.concat([])}).catch(function(e){console.log(e)}),a()})},changeTree:function(){this.formSearch.Userids=[],this.UserList=[],this.userbydepid()},exportFunnel:function(){var e=document.createElement("a");e.href="/api/Supplies/Goods/getBalanceOutExport?begindate=''",e.click()}}},w=y,C=(a("32d0"),a("2877")),P=Object(C["a"])(w,r,n,!1,null,null,null);t["default"]=P.exports},aef0:function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("a-drawer",{attrs:{message:"",visible:this.visible.show,width:950,destroyOnClose:!0,closable:!1},on:{close:e.onClose}},[a("template",{slot:"title"},[e._v("\n    客户明细\n  ")]),a("a-table",{attrs:{columns:e.columns,dataSource:e.dataSource,pagination:!1,rowKey:"ComProductLineGuid"},scopedSlots:e._u([{key:"CreatDate",fn:function(t,r){return a("span",{staticStyle:{"text-align":"right"}},[""!=r.PullTime?[e._v(e._s(r.PullTime))]:e._e(),""==r.PullTime?[e._v(e._s(r.CreatDate))]:e._e()],2)}},{key:"isOperate",fn:function(t,r){return a("span",{staticStyle:{"text-align":"right"}},[a("a-tag",{attrs:{color:1==r.Opened?"red":0==r.Cooperated?"blue":1==r.Cooperated?"green":""}},[1==r.Opened?[e._v("公海")]:e._e(),0==r.Opened?[e._v(e._s(r.CooperatedText))]:e._e()],2)],1)}},{key:"CityCode",fn:function(t,r){return a("span",{staticStyle:{"text-align":"right"}},[e._v("\n          "+e._s(e.cityList[r.CityCode])+"\n        ")])}}])},[a("template",{slot:"footer"},[a("a-pagination",{staticStyle:{float:"right"},attrs:{defaultCurrent:1,pageSize:e.formSearch.pageSize,total:e.formSearch.total,current:e.formSearch.current},on:{change:e.pagechange}})],1)],2),a("a-row",{staticStyle:{padding:"10px 0"},attrs:{gutter:24}})],2)},n=[],o=a("b775"),i=a("c32d"),s=a.n(i),c=[{title:"是否合作",scopedSlots:{customRender:"isOperate"}},{title:"公司名称",dataIndex:"ComName"},{title:"产品线",dataIndex:"ProductLineText"},{title:"城市",scopedSlots:{customRender:"CityCode"}},{title:"归属人",dataIndex:"UseridText"},{title:"入库时间",dataIndex:"PullTime"}],l={components:{},props:{show:{type:Object,default:{show:!1}},refresh:{type:Function,default:null}},data:function(){return{columns:c,visible:{show:!1,pFormSearch:{},detail:{}},formSearch:{pageSize:10,current:1,total:0},form:this.$form.createForm(this),drawer:{},modal:{},cityList:{},moment:s.a,dataSource:[]}},created:function(){var e=this,t=this;this.$watch("show",function(a,r){e.visible=a,console.log(e.visible),e.visible.show&&(e.formSearch.DepIds=t.visible.pFormSearch.DepIds,e.formSearch.ProductLines=t.visible.pFormSearch.ProductLines,e.formSearch.Userids=t.visible.pFormSearch.Userids,e.formSearch.Begin=t.visible.pFormSearch.Begin,e.formSearch.End=t.visible.pFormSearch.End,console.log(e.formSearch),e.init())})},methods:{init:function(){var e=this;e.initPage()},onClose:function(){this.visible.show=!1,this.dataSource=[],this.refresh&&this.refresh()},initPage:function(){this.pagechange(1)},pagerefresh:function(){this.pagechange(this.formSearch.current)},pagechange:function(e){var t=this,a={};console.log(t.formSearch),t.formSearch.current=e,a.pageSize=t.formSearch.pageSize,a.DepIds=t.formSearch.DepIds,a.ProductLines=t.formSearch.ProductLines,a.Userids=t.formSearch.Userids,a.current=t.formSearch.current,null==t.formSearch.Begin?delete a.Begin:a.Begin=s()(t.formSearch.Begin).format("YYYY-MM-DD"),null==t.formSearch.End?delete a.End:a.End=s()(t.formSearch.End).format("YYYY-MM-DD"),a.SaleStage=t.visible.SaleStage,a.DimKey=t.visible.detail.Key,t.$loading.open(),o["a"].post("/api/Crm/Data/SalesFunnelDetailByUpTime",a).then(function(e){t.$loading.close(),0===e.code?(t.dataSource=e.data.rows,t.formSearch.total=e.data.count):t.$message.error(e.msg)}).catch(function(e){t.$loading.close(),console.log(e)})}}},d=l,u=a("2877"),f=Object(u["a"])(d,r,n,!1,null,null,null);t["default"]=f.exports}}]);