(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-ba622a68","chunk-2d0def13"],{"1af6":function(t,e,a){var n=a("63b6");n(n.S,"Array",{isArray:a("9003")})},"4bc6":function(t,e,a){"use strict";a.r(e);var n=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("a-layout",[a("a-layout-content",[a("a-card",{attrs:{bordered:!1}},[a("div",[a("a-form",{attrs:{layout:"horizontal"}},[a("div",{class:t.advanced?null:"fold"},[a("a-row",{attrs:{gutter:10}},[a("a-col",{attrs:{md:6}},[a("a-form-item",{attrs:{label:"部门",labelCol:{span:4},wrapperCol:{span:20}}},[a("a-cascader",{attrs:{options:t.options,loadData:t.loadData,changeOnSelect:"",placeholder:"请选择部门"},on:{change:t.onChange},model:{value:t.formSearch.DepId,callback:function(e){t.$set(t.formSearch,"DepId",e)},expression:"formSearch.DepId"}})],1)],1),a("a-col",{attrs:{md:3}},[a("a-form-item",{attrs:{label:"人员",labelCol:{span:7},wrapperCol:{span:16}}},[a("a-select",{attrs:{allowClear:!0},model:{value:t.formSearch.Userid,callback:function(e){t.$set(t.formSearch,"Userid",e)},expression:"formSearch.Userid"}},t._l(t.UserList,function(e){return a("a-select-option",{key:e.code},[t._v(t._s(e.name))])}),1)],1)],1),a("a-col",{attrs:{md:4}},[a("a-form-item",{attrs:{label:"产品线",labelCol:{span:8},wrapperCol:{span:16}}},[a("a-select",{attrs:{placeholder:"请选择",allowClear:!0},model:{value:t.formSearch.ProductLine,callback:function(e){t.$set(t.formSearch,"ProductLine",e)},expression:"formSearch.ProductLine"}},t._l(t.ComProductLine,function(e){return a("a-select-option",{key:e.key},[t._v(t._s(e.text))])}),1)],1)],1),a("a-col",{attrs:{md:4}},[a("a-form-item",{attrs:{label:"开始时间",labelCol:{span:7},wrapperCol:{span:17}}},[a("a-date-picker",{staticStyle:{width:"100%"},attrs:{format:"YYYY-MM-DD"},model:{value:t.formSearch.Begin,callback:function(e){t.$set(t.formSearch,"Begin",e)},expression:"formSearch.Begin"}})],1)],1),a("a-col",{attrs:{md:4}},[a("a-form-item",{attrs:{label:"结束时间",labelCol:{span:7},wrapperCol:{span:17}}},[a("a-date-picker",{staticStyle:{width:"100%"},attrs:{format:"YYYY-MM-DD"},model:{value:t.formSearch.End,callback:function(e){t.$set(t.formSearch,"End",e)},expression:"formSearch.End"}})],1)],1),a("a-col",{attrs:{span:3}},[a("a-form-item",[a("a-button",{staticStyle:{"margin-right":"10px"},attrs:{type:"primary"},on:{click:t.initPage}},[t._v("查询")])],1)],1)],1)],1)])],1),a("a-row",[a("a-col",{attrs:{span:9}},[a("v-chart",{attrs:{"force-fit":!0,height:t.height,padding:t.padding,data:t.data,scale:t.scale}},[a("v-tooltip",{attrs:{"show-title":!1,"item-tpl":t.tooltipOpts.itemTpl}}),a("v-legend"),a("v-coord",{attrs:{type:"rect",direction:"LT"}}),a("v-pyramid",{attrs:{position:t.funnelOpts.position,color:t.funnelOpts.color,label:t.funnelOpts.label,tooltip:t.funnelOpts.tooltip}}),t._l(t.data,function(e,n){return a("v-guide",{key:n,attrs:{type:"text",top:!0,position:t.getPosition(e),content:t.getContent(e),vStyle:t.style}})})],2)],1),a("a-col",{attrs:{span:15}},[a("a-table",{attrs:{columns:t.columns,dataSource:t.contractList,pagination:!1,rowKey:"SaleStage"},scopedSlots:t._u([{key:"num",fn:function(e,n){return a("span",{staticStyle:{"text-align":"right"}},[a("a",{on:{click:function(e){return t.detail(n)}}},[t._v(t._s(n["现存"]))])])}}])})],1)],1)],1)],1),a("drawer-detail",{attrs:{show:t.drawer.detail,refresh:t.pagerefresh}})],1)},o=[],r=(a("8e6e"),a("456d"),a("75fc")),i=(a("7f7f"),a("bd86")),c=(a("ac6a"),a("b775")),s=a("c32d"),l=a.n(s),d=a("8896");function u(t,e){var a=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),a.push.apply(a,n)}return a}function p(t){for(var e=1;e<arguments.length;e++){var a=null!=arguments[e]?arguments[e]:{};e%2?u(a,!0).forEach(function(e){Object(i["a"])(t,e,a[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(a)):u(a).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(a,e))})}return t}var f=a("7104"),h=[],m={dataKey:"percent",nice:!1},g=(new f.View).source(h);g.transform({type:"percent",field:"Status",dimension:"action",as:"percent"});var S=g.rows,b={showTitle:!1,itemTpl:'<li data-index={index} style="margin-bottom:4px;"><span style="background-color:{color};" class="g2-tooltip-marker"></span>{name}<br/><span style="padding-left: 16px">数量：{Status}</span><br/><span style="padding-left: 16px">占比：{percent}</span><br/></li>'},y={position:"action*percent",color:["action",["#0050B3","#1890FF","#40A9FF","#69C0FF","#BAE7FF"]],label:["action*Status",function(t,e){return t+" "+e},{offset:35,labelLine:{lineWidth:1,stroke:"rgba(0, 0, 0, 0.15)"}}],tooltip:["action*Status*percent",function(t,e,a){return{name:t,percent:Math.floor(100*a)+"%",Status:e}}]},v=[{title:"销售阶段",dataIndex:"类型"},{title:"现数量",scopedSlots:{customRender:"num"}},{title:"转化率",dataIndex:"转化率"},{title:"数量汇总",dataIndex:"总计"}],w={components:{DrawerDetail:d["default"]},data:function(){return{advanced:!0,columns:v,sourceData:h,formSearch:{DepId:[],Userid:"",ProductLine:""},form:this.$form.createForm(this),contractList:[],roles:[],drawer:{detail:{show:!1}},modal:{},invalidlayer:!1,confirmLoading:!1,invalidRecord:{},status:[],ContractResult:[],PayDaySuffix:{},User:{},Dept:{},moment:l.a,comRankObject:{},rolesmanager:!1,data:S,padding:[50,120,95],scale:m,height:350,tooltipOpts:b,funnelOpts:y,style:{fill:"#fff",fontSize:"12",textAlign:"center",shadowBlur:2,shadowColor:"rgba(0, 0, 0, .45)"},dv:g,options:[],UserList:[],ComProductLine:[]}},mounted:function(){var t=this;t.init()},methods:{init:function(){var t=this;c["a"].post("/api/Dim/Enum/GetEnum",{Names:["ContractStatus","ContractResult","PayDaySuffix","ComRankNormal","ComProductLine"]}).then(function(e){0===e.code&&(t.status=e.data.ContractStatus,t.ContractResult=e.data.ContractResult,t.ComProductLine=e.data.ComProductLine,e.data.PayDaySuffix.forEach(function(e,a){t.PayDaySuffix[e.key]=e.text}),e.data.ComRankNormal.forEach(function(e,a){t.comRankObject[e.key]=e.text}))}).catch(function(t){console.log(t)}),c["a"].post("/api/Dim/Enum/DimDecode",{Names:["User","Dept"]}).then(function(e){t.$loading.close(),0===e.code&&(t.User=e.data.User,t.Dept=e.data.Dept)}).catch(function(e){t.$loading.close(),console.log(e)}),this.getAllDep(),this.pagechange(1)},initPage:function(){this.pagechange(1)},pagerefresh:function(){this.pagechange(this.formSearch.current)},pagechange:function(t){var e=this,a=p({},e.formSearch);e.formSearch.current=t,0==a.DepId.length?a.DepId="":a.DepId=a.DepId[a.DepId.length-1],null==a.Begin&&delete a.Begin,null==a.End&&delete a.End,e.form.validateFields(function(t,n){t||(e.$loading.open(),c["a"].post("/api/Crm/Data/SalesFunnel",a).then(function(t){if(e.$loading.close(),0===t.code){e.contractList=t.data.rows,e.data=[],t.data.rows.forEach(function(t,a){var n={action:t["类型"],Status:t["现存"]};e.data.push(n)});var a=(new f.View).source(e.data);a.transform({type:"percent",field:"Status",dimension:"action",as:"percent"}),console.log(a),e.data=a.rows,console.log(e.data)}}).catch(function(t){e.$loading.close(),console.log(t)}))})},detail:function(t){var e=this;this.drawer.detail={show:!0,pFormSearch:e.formSearch,SaleStage:t.SaleStage}},statusChange:function(t){this.formSearch.Result=40==t?10:""},getPosition:function(t){return{action:t.action,percent:"median"}},getContent:function(t){return parseInt(String(100*t.percent))+"%"},getAllDep:function(){var t=this;c["a"].get("/api/Org/Department/DepsByCurUser").then(function(e){0===e.code&&e.data.forEach(function(e,a){var n={};n.value=e.code,n.label=e.name,n.isLeaf=!1,t.options.push(n)})}).catch(function(t){console.log(t)})},loadData:function(t){var e=t[t.length-1],a=this;e.loading=!0,c["a"].post("/api/Org/Department/ChildrenDepsByDepId",{DepId:e.value}).then(function(t){e.loading=!1,0===t.code&&(t.data.length>0?(e.children=[],t.data.forEach(function(t,a){var n={};n.value=t.code,n.label=t.name,n.isLeaf=!1,e.children.push(n)}),a.options=Object(r["a"])(a.options)):(e.isLeaf=!0,e.loading=!1,a.options=Object(r["a"])(a.options)))}).catch(function(t){console.log(t),e.loading=!1})},onChange:function(t){this.UserList=[],this.formSearch.Userid="",this.userbydepid(t[t.length-1])},userbydepid:function(t){var e=this;c["a"].post("/api/Org/User/UsersByDepId",{DepId:t,Leaved:"1"==e.Leaved}).then(function(t){var a=t;0===a.code&&(e.UserList=a.data)}).catch(function(t){console.log(t)})}}},O=w,D=a("2877"),C=Object(D["a"])(O,n,o,!1,null,null,null);e["default"]=C.exports},"75fc":function(t,e,a){"use strict";var n=a("a745"),o=a.n(n);function r(t){if(o()(t)){for(var e=0,a=new Array(t.length);e<t.length;e++)a[e]=t[e];return a}}var i=a("774e"),c=a.n(i),s=a("c8bb"),l=a.n(s);function d(t){if(l()(Object(t))||"[object Arguments]"===Object.prototype.toString.call(t))return c()(t)}function u(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function p(t){return r(t)||d(t)||u()}a.d(e,"a",function(){return p})},"774e":function(t,e,a){t.exports=a("d2d5")},8896:function(t,e,a){"use strict";a.r(e);var n=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("a-drawer",{attrs:{message:"",visible:this.visible.show,width:950,destroyOnClose:!0,closable:!1},on:{close:t.onClose}},[a("template",{slot:"title"},[t._v("\n    客户明细\n  ")]),a("a-table",{attrs:{columns:t.columns,dataSource:t.dataSource,pagination:!1,rowKey:"ComProductLineGuid"},scopedSlots:t._u([{key:"CreatDate",fn:function(e,n){return a("span",{staticStyle:{"text-align":"right"}},[""!=n.PullTime?[t._v(t._s(n.PullTime))]:t._e(),""==n.PullTime?[t._v(t._s(n.CreatDate))]:t._e()],2)}},{key:"isOperate",fn:function(e,n){return a("span",{staticStyle:{"text-align":"right"}},[a("a-tag",{attrs:{color:1==n.Opened?"red":0==n.Cooperated?"blue":1==n.Cooperated?"green":""}},[1==n.Opened?[t._v("公海")]:t._e(),0==n.Opened?[t._v(t._s(n.CooperatedText))]:t._e()],2)],1)}},{key:"CityCode",fn:function(e,n){return a("span",{staticStyle:{"text-align":"right"}},[t._v("\n          "+t._s(t.cityList[n.CityCode])+"\n        ")])}}])},[a("template",{slot:"footer"},[a("a-pagination",{staticStyle:{float:"right"},attrs:{defaultCurrent:1,pageSize:t.formSearch.pageSize,total:t.formSearch.total,current:t.formSearch.current},on:{change:t.pagechange}})],1)],2),a("a-row",{staticStyle:{padding:"10px 0"},attrs:{gutter:24}})],2)},o=[],r=(a("8e6e"),a("ac6a"),a("456d"),a("bd86")),i=a("b775"),c=a("c32d"),s=a.n(c);function l(t,e){var a=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),a.push.apply(a,n)}return a}function d(t){for(var e=1;e<arguments.length;e++){var a=null!=arguments[e]?arguments[e]:{};e%2?l(a,!0).forEach(function(e){Object(r["a"])(t,e,a[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(a)):l(a).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(a,e))})}return t}var u=[{title:"是否合作",scopedSlots:{customRender:"isOperate"}},{title:"公司名称",dataIndex:"ComName"},{title:"产品线",dataIndex:"ProductLineText"},{title:"城市",scopedSlots:{customRender:"CityCode"}},{title:"归属人",dataIndex:"UseridText"},{title:"入库时间",dataIndex:"PullTime"}],p={components:{},props:{show:{type:Object,default:{show:!1}},refresh:{type:Function,default:null}},data:function(){return{columns:u,visible:{show:!1,pFormSearch:{},SaleStage:""},formSearch:{pageSize:10,current:1,total:0},form:this.$form.createForm(this),drawer:{},modal:{},cityList:{},moment:s.a,dataSource:[]}},created:function(){var t=this;this.$watch("show",function(e,a){t.visible=e,console.log(t.visible),t.visible.show&&(t.formSearch=d({pageSize:10,total:0},t.visible.pFormSearch),console.log(t.formSearch),t.init())})},methods:{init:function(){var t=this;t.initPage()},onClose:function(){this.visible.show=!1,this.dataSource=[],this.refresh&&this.refresh()},initPage:function(){this.pagechange(1)},pagerefresh:function(){this.pagechange(this.formSearch.current)},pagechange:function(t){var e=this,a={};e.formSearch.current=t,a.DepId=e.formSearch.DepId[e.formSearch.DepId.length-1],a.ProductLine=e.formSearch.ProductLine,a.Userid=e.formSearch.Userid,a.current=e.formSearch.current,a.pageSize=e.formSearch.pageSize,a.Begin=e.formSearch.Begin,a.End=e.formSearch.End,a.SaleStage=e.visible.SaleStage,e.$loading.open(),i["a"].post("/api/Crm/Data/SalesFunnelDetail",a).then(function(t){e.$loading.close(),0===t.code&&(e.dataSource=t.data.rows,e.formSearch.total=t.data.count)}).catch(function(t){e.$loading.close(),console.log(t)})}}},f=p,h=a("2877"),m=Object(h["a"])(f,n,o,!1,null,null,null);e["default"]=m.exports},a745:function(t,e,a){t.exports=a("f410")},c8bb:function(t,e,a){t.exports=a("54a1")},f410:function(t,e,a){a("1af6"),t.exports=a("584a").Array.isArray}}]);