(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-9990ea9e","chunk-2d0def13"],{"2f21":function(e,t,a){"use strict";var n=a("79e5");e.exports=function(e,t){return!!e&&n(function(){t?e.call(null,function(){},1):e.call(null)})}},"4bc6":function(e,t,a){"use strict";a.r(t);var n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("a-layout",[a("a-layout-content",[a("a-card",{attrs:{bordered:!1}},[a("a-row",{attrs:{gutter:40}},[a("a-col",{staticStyle:{"border-right":"1px solid #ddd","margin-right":"-1px"},attrs:{span:5}},[a("a-form",{attrs:{layout:"horizontal"}},[a("div",{class:e.advanced?null:"fold"},[a("div",{staticClass:"tab-title"},[e._v("筛选条件")]),a("a-row",{attrs:{gutter:10}},[a("a-col",{attrs:{md:24}},[a("a-form-item",{attrs:{label:"部门",labelCol:{span:8},wrapperCol:{span:16}}},[a("a-tree-select",{staticStyle:{width:"100%"},attrs:{multiple:"","tree-data-simple-mode":"","dropdown-style":{maxHeight:"400px",overflow:"auto"},"tree-data":e.treeData,placeholder:"请选择","load-data":e.onLoadData},on:{change:e.changeTree},model:{value:e.formSearch.DepIds,callback:function(t){e.$set(e.formSearch,"DepIds",t)},expression:"formSearch.DepIds"}})],1)],1),a("a-col",{attrs:{md:24}},[a("a-form-item",{attrs:{label:"人员",labelCol:{span:8},wrapperCol:{span:16}}},[a("a-select",{attrs:{mode:"multiple",allowClear:!0},model:{value:e.formSearch.Userids,callback:function(t){e.$set(e.formSearch,"Userids",t)},expression:"formSearch.Userids"}},e._l(e.UserList,function(t){return a("a-select-option",{key:t.code},[e._v(e._s(t.name))])}),1)],1)],1),a("a-col",{attrs:{md:24}},[a("a-form-item",{attrs:{label:"产品线",labelCol:{span:8},wrapperCol:{span:16}}},[a("a-select",{attrs:{placeholder:"请选择",allowClear:!0,mode:"multiple"},model:{value:e.formSearch.ProductLines,callback:function(t){e.$set(e.formSearch,"ProductLines",t)},expression:"formSearch.ProductLines"}},e._l(e.ComProductLine,function(t){return a("a-select-option",{key:t.key},[e._v(e._s(t.text))])}),1)],1)],1),a("a-col",{attrs:{md:24}},[a("a-form-item",{attrs:{label:"开始时间",labelCol:{span:8},wrapperCol:{span:16}}},[a("a-date-picker",{staticStyle:{width:"100%"},attrs:{format:"YYYY-MM-DD"},model:{value:e.formSearch.Begin,callback:function(t){e.$set(e.formSearch,"Begin",t)},expression:"formSearch.Begin"}})],1)],1),a("a-col",{attrs:{md:24}},[a("a-form-item",{attrs:{label:"结束时间",labelCol:{span:8},wrapperCol:{span:16}}},[a("a-date-picker",{staticStyle:{width:"100%"},attrs:{format:"YYYY-MM-DD"},model:{value:e.formSearch.End,callback:function(t){e.$set(e.formSearch,"End",t)},expression:"formSearch.End"}})],1)],1),a("a-col",{attrs:{md:16,offset:8}},[a("div",{staticClass:"btnBox"},[a("a-button",{staticStyle:{"margin-right":"10px"},attrs:{type:"primary",block:""},on:{click:e.initPage}},[e._v("查询")])],1)])],1)],1)])],1),a("a-col",{staticStyle:{"border-left":"1px solid #ddd"},attrs:{span:19}},[a("a-row",[a("a-col",{attrs:{span:10}},[a("v-chart",{attrs:{"force-fit":!0,height:e.height,padding:e.padding,data:e.data,scale:e.scale}},[a("v-tooltip",{attrs:{"show-title":!1,"item-tpl":e.tooltipOpts.itemTpl}}),a("v-legend"),a("v-coord",{attrs:{type:"rect",direction:"LT"}}),a("v-pyramid",{attrs:{position:e.funnelOpts.position,color:e.funnelOpts.color,label:e.funnelOpts.label,tooltip:e.funnelOpts.tooltip}}),e._l(e.data,function(t,n){return a("v-guide",{key:n,attrs:{type:"text",top:!0,position:e.getPosition(t),content:e.getContent(t),vStyle:e.style}})})],2)],1),a("a-col",{attrs:{span:14}},[a("a-table",{attrs:{columns:e.columns,dataSource:e.contractList,pagination:!1,rowKey:"SaleStage"},scopedSlots:e._u([{key:"num",fn:function(t,n){return a("span",{staticStyle:{"text-align":"right"}},[a("a",{on:{click:function(t){return e.detail(n)}}},[e._v(e._s(n["现存"]))])])}}])})],1)],1),a("a-row",[a("a-col",{attrs:{span:22}},[a("a-form",{attrs:{form:e.dimensionForm}},[a("a-form-item",{attrs:{label:"请选择维度",labelCol:{span:2},wrapperCol:{span:17}}},[a("a-checkbox-group",{attrs:{name:"checkboxgroup",options:e.plainOptions,"default-value":["按阶段"]},on:{change:e.changeDim},model:{value:e.dimension,callback:function(t){e.dimension=t},expression:"dimension"}})],1)],1)],1),a("a-col",{attrs:{span:24}},[e.saleProcesslist.length>0||e.checkDim.length>0?a("a-table",{attrs:{columns:e.columnsDim,dataSource:e.saleProcesslist,pagination:!1,rowKey:"index"},scopedSlots:e._u([{key:"Stage",fn:function(t,n){return a("span",{staticStyle:{"text-align":"right"}},[e._v("\n                    "+e._s(e.SaleStageObj[n.Key.Stage])+"\n                  ")])}},{key:"ProductLine",fn:function(t,n){return a("span",{staticStyle:{"text-align":"right"}},[e._v("\n                    "+e._s(e.ComProductLineObj[n.Key.ProductLine])+"\n                  ")])}},{key:"userid",fn:function(t,n){return a("span",{staticStyle:{"text-align":"right"}},[e._v("\n                    "+e._s(e.User[n.Key.Userid])+"\n                  ")])}},{key:"dimMonth",fn:function(t,n){return a("span",{staticStyle:{"text-align":"right"}},[e._v("\n                    "+e._s(n.Key["预期成交月份"])+"\n                  ")])}}],null,!1,4223985511)}):e._e()],1)],1)],1)],1)],1)],1),a("drawer-detail",{attrs:{show:e.drawer.detail,refresh:e.pagerefresh}})],1)},o=[],r=(a("8e6e"),a("456d"),a("55dd"),a("7f7f"),a("bd86")),i=(a("ac6a"),a("b775")),s=a("c32d"),c=a.n(s),l=a("8896");function d(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),a.push.apply(a,n)}return a}function u(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?d(a,!0).forEach(function(t){Object(r["a"])(e,t,a[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):d(a).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))})}return e}var p=a("7104"),f=[],m={dataKey:"percent",nice:!1},h=(new p.View).source(f);h.transform({type:"percent",field:"Status",dimension:"action",as:"percent"});var g=h.rows,S={showTitle:!1,itemTpl:'<li data-index={index} style="margin-bottom:4px;"><span style="background-color:{color};" class="g2-tooltip-marker"></span>{name}<br/><span style="padding-left: 16px">数量：{Status}</span><br/><span style="padding-left: 16px">占比：{percent}</span><br/></li>'},b={position:"action*percent",color:["action",["#0050B3","#1890FF","#40A9FF","#69C0FF","#BAE7FF"]],label:["action*Status",function(e,t){return e+" "+t},{offset:35,labelLine:{lineWidth:1,stroke:"rgba(0, 0, 0, 0.15)"}}],tooltip:["action*Status*percent",function(e,t,a){return{name:e,percent:Math.floor(100*a)+"%",Status:t}}]},v=[{title:"销售阶段",dataIndex:"类型"},{title:"现数量",scopedSlots:{customRender:"num"}},{title:"转化率",dataIndex:"转化率"},{title:"数量汇总",dataIndex:"总计"}],y=[{title:"销售阶段",scopedSlots:{customRender:"Stage"}},{title:"产品线条数",dataIndex:"产品线条数"},{title:"预期业绩",dataIndex:"预期业绩"}],D=[{label:"按阶段",value:"0"},{label:"按产品线",value:"1"},{label:"按人员",value:"2"},{label:"预期成交月份",value:"3"}],w={0:"Stage",1:"ProductLine",2:"Userid",3:"预期成交月份"},x={components:{DrawerDetail:l["default"]},data:function(){return{advanced:!0,columns:v,columnsDim:y,sourceData:f,formSearch:{DepIds:[],Userids:[],ProductLines:[]},middleSearch:{},form:this.$form.createForm(this),dimensionForm:this.$form.createForm(this),contractList:[],roles:[],drawer:{detail:{show:!1}},modal:{},invalidlayer:!1,confirmLoading:!1,invalidRecord:{},status:[],ContractResult:[],PayDaySuffix:{},User:{},Dept:{},moment:c.a,comRankObject:{},rolesmanager:!1,data:g,padding:[50,120,95],scale:m,height:350,tooltipOpts:S,funnelOpts:b,style:{fill:"#fff",fontSize:"12",textAlign:"center",shadowBlur:2,shadowColor:"rgba(0, 0, 0, .45)"},dv:h,options:[],UserList:[],ComProductLine:[],ComProductLineObj:{},plainOptions:D,dimension:["0"],checkDim:["0"],plainOptionsObject:w,saleProcesslist:[],SaleStageObj:{},treeData:[]}},mounted:function(){var e=this;e.init()},methods:{init:function(){var e=this;i["a"].post("/api/Dim/Enum/GetEnum",{Names:["ContractStatus","ContractResult","PayDaySuffix","ComRankNormal","ComProductLine","SaleStage"]}).then(function(t){0===t.code&&(e.status=t.data.ContractStatus,e.ContractResult=t.data.ContractResult,e.ComProductLine=t.data.ComProductLine,t.data.PayDaySuffix.forEach(function(t,a){e.PayDaySuffix[t.key]=t.text}),t.data.ComRankNormal.forEach(function(t,a){e.comRankObject[t.key]=t.text}),t.data.SaleStage.forEach(function(t,a){e.SaleStageObj[t.key]=t.text}),t.data.ComProductLine.forEach(function(t,a){e.ComProductLineObj[t.key]=t.text}))}).catch(function(e){console.log(e)}),i["a"].post("/api/Dim/Enum/DimDecode",{Names:["User","Dept"]}).then(function(t){e.$loading.close(),0===t.code&&(e.User=t.data.User,e.Dept=t.data.Dept)}).catch(function(t){e.$loading.close(),console.log(t)}),this.getAllDep(),this.pagechange(1)},initPage:function(){this.pagechange(1)},pagerefresh:function(){this.pagechange(this.formSearch.current)},pagechange:function(e){var t=this,a=u({},t.formSearch);t.formSearch.current=e,null==a.Begin?delete a.Begin:a.Begin=c()(a.Begin).format("YYYY-MM-DD"),null==a.End?delete a.End:a.End=c()(a.End).format("YYYY-MM-DD"),t.middleSearch=u({},t.formSearch),t.form.validateFields(function(e,n){e||(t.$loading.open(),i["a"].post("/api/Crm/Data/SalesFunnel",a).then(function(e){if(t.$loading.close(),0===e.code){t.contractList=e.data.rows,t.data=[],e.data.rows.forEach(function(e,a){if("签约客户"!=e["类型"]){var n={action:e["类型"],Status:e["现存"]};t.data.push(n)}});var a=(new p.View).source(t.data);a.transform({type:"percent",field:"Status",dimension:"action",as:"percent"}),console.log(a),t.data=a.rows,console.log(t.data)}}).catch(function(e){t.$loading.close(),console.log(e)})),t.serchDim()})},serchDim:function(){var e=this;if(e.checkDim.length>0){var t={};t=u({},e.middleSearch),null==t.Begin?delete t.Begin:t.Begin=c()(t.Begin).format("YYYY-MM-DD"),null==t.End?delete t.End:t.End=c()(t.End).format("YYYY-MM-DD"),t.Dims=[],e.checkDim.forEach(function(a){t.Dims.push(e.plainOptionsObject[a])}),i["a"].post("/api/Crm/Data/SalesProcess",t).then(function(t){e.$loading.close(),0===t.code&&(e.saleProcesslist=t.data.rows)}).catch(function(t){e.$loading.close(),console.log(t)})}},detail:function(e){var t=this;this.drawer.detail={show:!0,pFormSearch:t.formSearch,SaleStage:e.SaleStage}},statusChange:function(e){this.formSearch.Result=40==e?10:""},getPosition:function(e){return{action:e.action,percent:"median"}},getContent:function(e){return parseInt(String(100*e.percent))+"%"},getAllDep:function(){var e=this;i["a"].get("/api/Org/Department/DepsByCurUser").then(function(t){0===t.code&&t.data.forEach(function(t,a){var n={};n.id=t.code,n.pId=0,n.value=t.code,n.title=t.name,n.isLeaf=!1,e.treeData.push(n)})}).catch(function(e){console.log(e)})},userbydepid:function(){var e=this;i["a"].post("/api/Org/User/DescendantsUsersByDepId",{DepIds:e.formSearch.DepIds,Leaved:!1}).then(function(t){var a=t;0===a.code&&(e.UserList=a.data)}).catch(function(e){console.log(e)})},changeDim:function(e){var t=[],a=[{title:"销售阶段",scopedSlots:{customRender:"Stage"}},{title:"产品线",scopedSlots:{customRender:"ProductLine"}},{title:"人员",scopedSlots:{customRender:"userid"}},{title:"预期成交月份",scopedSlots:{customRender:"dimMonth"}}];e.sort(function(e,t){return e-t}),console.log(e),e.length>0&&(e.forEach(function(e){t.push(a[e])}),t.push({title:"产品线条数",dataIndex:"产品线条数"}),t.push({title:"预期业绩",dataIndex:"预期业绩"})),this.columnsDim=t,this.checkDim=e,this.serchDim()},onLoadData:function(e){var t=this;return new Promise(function(a){var n=e.dataRef.id;i["a"].post("/api/Org/Department/ChildrenDepsByDepId",{DepId:n}).then(function(e){if(0===e.code)if(e.data.length>0){var a=[];e.data.forEach(function(e,t){var o={};o.id=e.code,o.pId=n,o.value=e.code,o.title=e.name,o.isLeaf=!1,a.push(o)}),t.treeData=t.treeData.concat(a)}else t.treeData=t.treeData.concat([])}).catch(function(e){console.log(e)}),a()})},changeTree:function(){this.formSearch.Userids=[],this.UserList=[],this.userbydepid()},exportFunnel:function(){var e=document.createElement("a");e.href="/api/Supplies/Goods/getBalanceOutExport?begindate=''",e.click()}}},C=x,P=(a("f365"),a("2877")),O=Object(P["a"])(C,n,o,!1,null,null,null);t["default"]=O.exports},"55dd":function(e,t,a){"use strict";var n=a("5ca1"),o=a("d8e8"),r=a("4bf8"),i=a("79e5"),s=[].sort,c=[1,2,3];n(n.P+n.F*(i(function(){c.sort(void 0)})||!i(function(){c.sort(null)})||!a("2f21")(s)),"Array",{sort:function(e){return void 0===e?s.call(r(this)):s.call(r(this),o(e))}})},8896:function(e,t,a){"use strict";a.r(t);var n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("a-drawer",{attrs:{message:"",visible:this.visible.show,width:950,destroyOnClose:!0,closable:!1},on:{close:e.onClose}},[a("template",{slot:"title"},[e._v("\n    客户明细\n  ")]),a("a-table",{attrs:{columns:e.columns,dataSource:e.dataSource,pagination:!1,rowKey:"ComProductLineGuid"},scopedSlots:e._u([{key:"CreatDate",fn:function(t,n){return a("span",{staticStyle:{"text-align":"right"}},[""!=n.PullTime?[e._v(e._s(n.PullTime))]:e._e(),""==n.PullTime?[e._v(e._s(n.CreatDate))]:e._e()],2)}},{key:"isOperate",fn:function(t,n){return a("span",{staticStyle:{"text-align":"right"}},[a("a-tag",{attrs:{color:1==n.Opened?"red":0==n.Cooperated?"blue":1==n.Cooperated?"green":""}},[1==n.Opened?[e._v("公海")]:e._e(),0==n.Opened?[e._v(e._s(n.CooperatedText))]:e._e()],2)],1)}},{key:"CityCode",fn:function(t,n){return a("span",{staticStyle:{"text-align":"right"}},[e._v("\n          "+e._s(e.cityList[n.CityCode])+"\n        ")])}}])},[a("template",{slot:"footer"},[a("a-pagination",{staticStyle:{float:"right"},attrs:{defaultCurrent:1,pageSize:e.formSearch.pageSize,total:e.formSearch.total,current:e.formSearch.current},on:{change:e.pagechange}})],1)],2),a("a-row",{staticStyle:{padding:"10px 0"},attrs:{gutter:24}})],2)},o=[],r=a("b775"),i=a("c32d"),s=a.n(i),c=[{title:"是否合作",scopedSlots:{customRender:"isOperate"}},{title:"公司名称",dataIndex:"ComName"},{title:"产品线",dataIndex:"ProductLineText"},{title:"城市",scopedSlots:{customRender:"CityCode"}},{title:"归属人",dataIndex:"UseridText"},{title:"入库时间",dataIndex:"PullTime"}],l={components:{},props:{show:{type:Object,default:{show:!1}},refresh:{type:Function,default:null}},data:function(){return{columns:c,visible:{show:!1,pFormSearch:{},SaleStage:""},formSearch:{pageSize:10,current:1,total:0},form:this.$form.createForm(this),drawer:{},modal:{},cityList:{},moment:s.a,dataSource:[]}},created:function(){var e=this,t=this;this.$watch("show",function(a,n){e.visible=a,console.log(e.visible),e.visible.show&&(e.formSearch.DepIds=t.visible.pFormSearch.DepIds,e.formSearch.ProductLines=t.visible.pFormSearch.ProductLines,e.formSearch.Userids=t.visible.pFormSearch.Userids,e.formSearch.Begin=t.visible.pFormSearch.Begin,e.formSearch.End=t.visible.pFormSearch.End,console.log(e.formSearch),e.init())})},methods:{init:function(){var e=this;e.initPage()},onClose:function(){this.visible.show=!1,this.dataSource=[],this.refresh&&this.refresh()},initPage:function(){this.pagechange(1)},pagerefresh:function(){this.pagechange(this.formSearch.current)},pagechange:function(e){var t=this,a={};console.log(t.formSearch),t.formSearch.current=e,a.pageSize=t.formSearch.pageSize,a.DepIds=t.formSearch.DepIds,a.ProductLines=t.formSearch.ProductLines,a.Userids=t.formSearch.Userids,a.current=t.formSearch.current,null==t.formSearch.Begin?delete a.Begin:a.Begin=s()(t.formSearch.Begin).format("YYYY-MM-DD"),null==t.formSearch.End?delete a.End:a.End=s()(t.formSearch.End).format("YYYY-MM-DD"),a.SaleStage=t.visible.SaleStage,t.$loading.open(),r["a"].post("/api/Crm/Data/SalesFunnelDetail",a).then(function(e){t.$loading.close(),0===e.code&&(t.dataSource=e.data.rows,t.formSearch.total=e.data.count)}).catch(function(e){t.$loading.close(),console.log(e)})}}},d=l,u=a("2877"),p=Object(u["a"])(d,n,o,!1,null,null,null);t["default"]=p.exports},e948:function(e,t,a){},f365:function(e,t,a){"use strict";var n=a("e948"),o=a.n(n);o.a}}]);