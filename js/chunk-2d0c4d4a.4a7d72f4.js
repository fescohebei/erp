(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2d0c4d4a"],{"3d03":function(e,t,i){"use strict";i.r(t);var a=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("a-drawer",{attrs:{title:"修改",placement:"right",closable:!1,maskClosable:!1,visible:this.visible.show,width:700}},[i("a-form",{attrs:{form:e.form}},[i("a-form-item",{attrs:{label:"财年",labelCol:{span:4},wrapperCol:{span:20}}},[i("a-select",{directives:[{name:"decorator",rawName:"v-decorator",value:["BudgetGuid",{initialValue:e.visible.detail.BudgetGuid,rules:e.AFormImportRules.iptSelect}],expression:"['BudgetGuid',{initialValue:visible.detail.BudgetGuid,rules:AFormImportRules.iptSelect }]"}],staticStyle:{width:"60%","margin-right":"8px"},attrs:{placeholder:"请选择",allowClear:!0,disabled:!!e.visible.detail.BudgetDeptGuid},on:{change:e.selectFiscalYearChange}},e._l(e.dim.budgets,function(t){return i("a-select-option",{key:t.BudgetGuid},[e._v(e._s(t.FiscalYear))])}),1)],1),i("a-form-item",{attrs:{label:"部门",labelCol:{span:4},wrapperCol:{span:20}}},[i("a-cascader",{directives:[{name:"decorator",rawName:"v-decorator",value:["Depts",{initialValue:e.visible.detail.DepPath,rules:e.AFormImportRules.iptSelect}],expression:"['Depts',{initialValue:visible.detail.DepPath,rules:AFormImportRules.iptSelect }]"}],attrs:{options:e.dim.depts,changeOnSelect:"",placeholder:"请选择",disabled:!!e.visible.detail.BudgetDeptGuid}})],1),e._l(e.dim.subjects,function(t,a){return i("a-form-item",{key:a,attrs:{label:t.Name,labelCol:{span:4},wrapperCol:{span:20}}},[i("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["Amount["+t.BSGuid+"]",{rules:e.AFormImportRules.iptInput}],expression:"[`Amount[${item.BSGuid}]`,\n        {\n          rules: AFormImportRules.iptInput,\n        }\n      ]"}],staticStyle:{width:"60%","margin-right":"8px"}})],1)}),i("a-form-item",{attrs:{label:"备注",labelCol:{span:4},wrapperCol:{span:20}}},[i("a-textarea",{directives:[{name:"decorator",rawName:"v-decorator",value:["Remarks",{initialValue:e.visible.detail.Remarks}],expression:"['Remarks',{initialValue:visible.detail.Remarks }]"}],attrs:{placeholder:"备注",rows:4}})],1)],2),i("div",{style:{position:"absolute",bottom:0,width:"100%",borderTop:"1px solid #e8e8e8",padding:"10px 16px",textAlign:"right",left:0,background:"#fff",borderRadius:"0 0 4px 4px"}},[i("a-button",{on:{click:e.onClose}},[e._v("取消")]),i("a-button",{staticStyle:{"margin-left":"8px"},attrs:{type:"primary","html-type":"submit"},on:{click:e.handleSubmit}},[e._v("提交")]),null==e.visible.id?i("a-button",{staticStyle:{"margin-left":"8px"},on:{click:function(t){return e.handleSubmit("next")}}},[e._v("提交并继续录入")]):e._e()],1)],1)},s=[],l=(i("ac6a"),i("b775")),r={props:{show:{type:Object,default:{show:!1}},refresh:{type:Function,default:null}},data:function(){return{visible:{show:!1,detail:{BudgetGuid:void 0}},dim:{depts:[],subjects:[],budgets:[]},subjects:[],form:this.$form.createForm(this),AFormImportRules:{iptInput:[{required:!0,message:"请输入"}],iptSelect:[{required:!0,message:"请选择"}]}}},watch:{show:function(e,t){var i=this;i.visible=e,e.show&&(null==i.visible.detail&&(i.visible.detail={BudgetGuid:void 0}),i.init())}},methods:{onClose:function(){this.visible.show=!1,this.refresh&&this.refresh(),this.dim.subjects=[],this.form.resetFields()},init:function(){var e=this;l["a"].post("/api/Budget/Set/InitGroups").then(function(t){0===t.code&&(e.dim.depts=t.data.depts,e.dim.budgets=t.data.budgets)}).catch(function(e){console.log(e)}),e.visible.detail.BudgetDeptGuid&&l["a"].post("/api/Budget/Formation/GetItems",{BudgetDeptGuid:e.visible.detail.BudgetDeptGuid}).then(function(t){0===t.code&&(t.data.budget_Dept.DepPath=JSON.parse(t.data.budget_Dept.DepPath),e.visible.detail=t.data.budget_Dept,e.selectFiscalYearChange(e.visible.detail.BudgetGuid).then(function(){var i={};t.data.items.forEach(function(e){var t="Amount["+e.BSGuid+"]";i[t]=e.Amount}),e.form.setFieldsValue(i)}))}).catch(function(e){console.log(e)})},handleSubmit:function(e){var t=this;this.form.validateFields(function(i,a){if(!i){var s=a;s.Amount=JSON.stringify(a.Amount),s.DepPath=JSON.stringify(a.Depts),s.DepGuid=a.Depts[a.Depts.length-1],s.BudgetDeptGuid=t.visible.detail.BudgetDeptGuid,l["a"].post("/api/Budget/Formation/SaveItem",s).then(function(i){var a=i;a.code>0?t.$message.error(a.msg):("next"===e?(t.form.resetFields(),t.refresh&&t.refresh()):t.onClose(),t.$message.success(a.msg))}).catch(function(e){console.log(e)})}})},selectFiscalYearChange:function(e){var t=this;if(e)return t.dim.subjects=[],l["a"].post("/api/Budget/Set/GetConfig",{BudgetGuid:e}).then(function(e){0===e.code&&(t.dim.subjects=e.data.subjects)}).catch(function(e){console.log(e)});t.dim.subjects=[]}}},o=r,n=i("2877"),d=Object(n["a"])(o,a,s,!1,null,null,null);t["default"]=d.exports}}]);